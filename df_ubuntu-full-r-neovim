FROM ubuntu-full-r:0.1

RUN apt-get update &&\
    apt-get install -y\
    neovim-qt &&\
    rm -r /var/lib/apt/lists/*

# Create user by editing /etc/passwd, /etc/shadow, /etc/group, and /etc/gshadow (uid, gid default to 1000; shell defaults to sh)
# Create home directory (defaults to /home/<user>)
# macOS docker auto-maps macOS UIDs to different linux UIDs
# https://stackoverflow.com/questions/43097341/docker-on-macosx-does-not-translate-file-ownership-correctly-in-volumes
# If you specify a username, the standard first-user UID/GID of 1000 will be given to the name
RUN useradd -m developer

# Instead of running passwd (sudo requires a password), let's grant our user unrestricted superpowers:
# The sudoer syntax: User Host = (Runas) Options Command
# Below we are saying to let developer sudo-run any command as anyone, and don't require a password. 
# (It's a risky config if anyone ever had access through the web to our docker container but fine otherwise)
# Host simply controls what hosts this would be valid on if this file were present on the host. We say all hosts.
RUN echo "developer ALL=(ALL) NOPASSWD: ALL" > /etc/sudoers.d/developer &&\
    chmod 0440 /etc/sudoers.d/developer

# Change user from sudo to developer
USER developer

# Work from ~/
WORKDIR /home/developer

# Preparing neovim
RUN mkdir -p /home/developer/.config/nvim
RUN mkdir -p /home/developer/.cache/dein
RUN curl https://raw.githubusercontent.com/Shougo/dein.vim/master/bin/installer.sh > installer.sh
RUN chmod +x installer.sh
RUN ./installer.sh /home/developer/.cache/dein